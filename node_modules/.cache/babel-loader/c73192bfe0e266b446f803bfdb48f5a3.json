{"ast":null,"code":"var _jsxFileName = \"/Users/neara/c/collab-demo/src/apps/UndoAware.js\",\n    _s = $RefreshSig$();\n\nimport { useReducer } from \"react\";\nimport { getRandomIndex, capitaliseLetterAtIndex, deleteEverySecondLetter, lowercaseLetterAtIndex, restoreDeletedLetters } from \"./helpers\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst dispatchOp = (textDispatch, historyDispatch, op) => {\n  historyDispatch({\n    type: 'push',\n    payload: op\n  });\n  textDispatch(op.do);\n};\n\nconst dispatchCapitalise = (textState, textDispatch, historyDispatch) => {\n  const randomIndex = getRandomIndex(textState.text);\n  dispatchOp(textDispatch, historyDispatch, {\n    do: {\n      type: 'capitalise',\n      payload: {\n        index: randomIndex\n      }\n    },\n    undo: {\n      type: 'undo_capitalise',\n      payload: {\n        index: randomIndex\n      }\n    }\n  });\n};\n\nconst dispatchDelete = (textState, textDispatch, historyDispatch) => {\n  const deletedLetters = deleteEverySecondLetter(textState.text.substring(1));\n  dispatchOp({\n    do: {\n      type: 'delete'\n    },\n    undo: {\n      type: 'undo_delete',\n      payload: {\n        deletedLetters\n      }\n    }\n  });\n};\n\nconst dispatchUndo = (historyState, historyDispatch, textDispatch) => {\n  const {\n    opStack,\n    index\n  } = historyState;\n\n  if (index > 0) {\n    textDispatch(opStack[index].undo);\n    historyDispatch({\n      type: 'undo'\n    });\n  }\n};\n\nconst dispatchRedo = (historyState, historyDispatch, textDispatch) => {\n  const {\n    opStack,\n    index\n  } = historyState;\n\n  if (index < opStack.length - 1) {\n    textDispatch(opStack[index].do);\n    historyDispatch({\n      type: 'redo'\n    });\n  }\n};\n\nconst textReducer = (state, action) => {\n  if (action.type === 'capitalise') {\n    return {\n      text: capitaliseLetterAtIndex(state.text, action.payload.index)\n    };\n  }\n\n  if (action.type === 'undo_capitalise') {\n    return {\n      text: lowercaseLetterAtIndex(state.text, action.payload.index)\n    };\n  }\n\n  if (action.type === 'delete') {\n    return {\n      text: deleteEverySecondLetter(state.text)\n    };\n  }\n\n  if (action.type === 'undo_delete') {\n    return {\n      text: restoreDeletedLetters(state.text, action.payload.deletedLetters)\n    };\n  }\n\n  return state;\n};\n\nconst historyReducer = (state, action) => {\n  if (action.type === 'push') {\n    const {\n      opStack,\n      index\n    } = state;\n    const newOpStack = opStack.slice(0, index).concat([action.payload]);\n    return {\n      opStack: newOpStack,\n      index: newOpStack.length\n    };\n  }\n\n  if (action.type === 'undo') {\n    return {\n      opStack: state.opStack,\n      index: Math.max(state.index - 1, 0)\n    };\n  }\n\n  if (action.type === 'redo') {\n    return {\n      opStack: state.opStack,\n      index: Math.min(state.index + 1, state.opStack.length)\n    };\n  }\n\n  return state;\n};\n\nconst UndoAwareApp = () => {\n  _s();\n\n  const [textState, textDispatch] = useReducer(textReducer, {\n    text: 'lorem ipsum dolor sit amet'\n  });\n  const [historyState, historyDispatch] = useReducer(historyReducer, {\n    opStack: [],\n    index: 0\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"Text: \", textState.text]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"Undo stack: \", JSON.stringify(historyState)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => dispatchCapitalise(textState),\n        children: \"Capitalise random letter\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => dispatchDelete(textState),\n        children: \"Delete every second letter\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => dispatchUndo(historyState, historyDispatch, textDispatch),\n        children: \"Undo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => dispatchRedo(historyState, historyDispatch, textDispatch),\n        children: \"Redo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 114,\n    columnNumber: 9\n  }, this);\n};\n\n_s(UndoAwareApp, \"F3bHkequbHqmGT7QR9pIvTOuJok=\");\n\n_c = UndoAwareApp;\nexport default UndoAwareApp;\n\nvar _c;\n\n$RefreshReg$(_c, \"UndoAwareApp\");","map":{"version":3,"names":["useReducer","getRandomIndex","capitaliseLetterAtIndex","deleteEverySecondLetter","lowercaseLetterAtIndex","restoreDeletedLetters","dispatchOp","textDispatch","historyDispatch","op","type","payload","do","dispatchCapitalise","textState","randomIndex","text","index","undo","dispatchDelete","deletedLetters","substring","dispatchUndo","historyState","opStack","dispatchRedo","length","textReducer","state","action","historyReducer","newOpStack","slice","concat","Math","max","min","UndoAwareApp","JSON","stringify"],"sources":["/Users/neara/c/collab-demo/src/apps/UndoAware.js"],"sourcesContent":["import { useReducer } from \"react\";\nimport { getRandomIndex, capitaliseLetterAtIndex, deleteEverySecondLetter, lowercaseLetterAtIndex, restoreDeletedLetters } from \"./helpers\";\n\nconst dispatchOp = (textDispatch, historyDispatch, op) => {\n    historyDispatch({ type: 'push', payload: op });\n    textDispatch(op.do);\n}\n\nconst dispatchCapitalise = (textState, textDispatch, historyDispatch) => {\n    const randomIndex = getRandomIndex(textState.text);\n\n    dispatchOp(textDispatch, historyDispatch, {\n        do: { type: 'capitalise', payload: { index: randomIndex } },\n        undo: { type: 'undo_capitalise', payload: { index: randomIndex } },\n    });\n}\n\nconst dispatchDelete = (textState, textDispatch, historyDispatch) => {\n    const deletedLetters = deleteEverySecondLetter(textState.text.substring(1));\n\n    dispatchOp({\n        do: { type: 'delete', },\n        undo: { type: 'undo_delete', payload: { deletedLetters, } },\n    });\n}\n\nconst dispatchUndo = (historyState, historyDispatch, textDispatch) => {\n    const { opStack, index } = historyState;\n\n    if (index > 0) {\n        textDispatch(opStack[index].undo);\n        historyDispatch({ type: 'undo' });\n    }\n}\n\nconst dispatchRedo = (historyState, historyDispatch, textDispatch) => {\n    const { opStack, index } = historyState;\n\n    if (index < opStack.length - 1) {\n        textDispatch(opStack[index].do);\n        historyDispatch({ type: 'redo' });\n    }\n}\n\nconst textReducer = (state, action) => {\n    if (action.type === 'capitalise') {\n        return {\n            text: capitaliseLetterAtIndex(state.text, action.payload.index),\n        };\n    }\n\n    if (action.type === 'undo_capitalise') {\n        return {\n            text: lowercaseLetterAtIndex(state.text, action.payload.index),\n        };\n    }\n\n    if (action.type === 'delete') {\n        return {\n            text: deleteEverySecondLetter(state.text),\n        };\n    }\n\n    if (action.type === 'undo_delete') {\n        return {\n            text: restoreDeletedLetters(state.text, action.payload.deletedLetters),\n        };\n    }\n\n    return state;\n}\n\nconst historyReducer = (state, action) => {\n    if (action.type === 'push') {\n        const { opStack, index } = state;\n\n        const newOpStack = opStack.slice(0, index).concat([action.payload]);\n\n        return {\n            opStack: newOpStack,\n            index: newOpStack.length,\n        };\n    }\n\n    if (action.type === 'undo') {\n        return {\n            opStack: state.opStack,\n            index: Math.max(state.index - 1, 0),\n        };\n    }\n\n    if (action.type === 'redo') {\n        return {\n            opStack: state.opStack,\n            index: Math.min(state.index + 1, state.opStack.length),\n        };\n    }\n\n    return state;\n}\n\nconst UndoAwareApp = () => {\n    const [textState, textDispatch] = useReducer(\n        textReducer,\n        { text: 'lorem ipsum dolor sit amet' },\n    );\n\n    const [historyState, historyDispatch] = useReducer(\n        historyReducer,\n        { opStack: [], index: 0, },\n    );\n\n    return (\n        <div>\n            <div>Text: {textState.text}</div>\n            <div>Undo stack: {JSON.stringify(historyState)}</div>\n            <div>\n                <button onClick={() => dispatchCapitalise(textState)}>Capitalise random letter</button>\n                <button onClick={() => dispatchDelete(textState)}>Delete every second letter</button>\n            </div>\n            <div>\n                <button onClick={() => dispatchUndo(historyState, historyDispatch, textDispatch)}>\n                    Undo\n                </button>\n                <button onClick={() => dispatchRedo(historyState, historyDispatch, textDispatch)}>\n                    Redo\n                </button>\n            </div>\n        </div >\n    )\n}\n\nexport default UndoAwareApp;\n"],"mappings":";;;AAAA,SAASA,UAAT,QAA2B,OAA3B;AACA,SAASC,cAAT,EAAyBC,uBAAzB,EAAkDC,uBAAlD,EAA2EC,sBAA3E,EAAmGC,qBAAnG,QAAgI,WAAhI;;;AAEA,MAAMC,UAAU,GAAG,CAACC,YAAD,EAAeC,eAAf,EAAgCC,EAAhC,KAAuC;EACtDD,eAAe,CAAC;IAAEE,IAAI,EAAE,MAAR;IAAgBC,OAAO,EAAEF;EAAzB,CAAD,CAAf;EACAF,YAAY,CAACE,EAAE,CAACG,EAAJ,CAAZ;AACH,CAHD;;AAKA,MAAMC,kBAAkB,GAAG,CAACC,SAAD,EAAYP,YAAZ,EAA0BC,eAA1B,KAA8C;EACrE,MAAMO,WAAW,GAAGd,cAAc,CAACa,SAAS,CAACE,IAAX,CAAlC;EAEAV,UAAU,CAACC,YAAD,EAAeC,eAAf,EAAgC;IACtCI,EAAE,EAAE;MAAEF,IAAI,EAAE,YAAR;MAAsBC,OAAO,EAAE;QAAEM,KAAK,EAAEF;MAAT;IAA/B,CADkC;IAEtCG,IAAI,EAAE;MAAER,IAAI,EAAE,iBAAR;MAA2BC,OAAO,EAAE;QAAEM,KAAK,EAAEF;MAAT;IAApC;EAFgC,CAAhC,CAAV;AAIH,CAPD;;AASA,MAAMI,cAAc,GAAG,CAACL,SAAD,EAAYP,YAAZ,EAA0BC,eAA1B,KAA8C;EACjE,MAAMY,cAAc,GAAGjB,uBAAuB,CAACW,SAAS,CAACE,IAAV,CAAeK,SAAf,CAAyB,CAAzB,CAAD,CAA9C;EAEAf,UAAU,CAAC;IACPM,EAAE,EAAE;MAAEF,IAAI,EAAE;IAAR,CADG;IAEPQ,IAAI,EAAE;MAAER,IAAI,EAAE,aAAR;MAAuBC,OAAO,EAAE;QAAES;MAAF;IAAhC;EAFC,CAAD,CAAV;AAIH,CAPD;;AASA,MAAME,YAAY,GAAG,CAACC,YAAD,EAAef,eAAf,EAAgCD,YAAhC,KAAiD;EAClE,MAAM;IAAEiB,OAAF;IAAWP;EAAX,IAAqBM,YAA3B;;EAEA,IAAIN,KAAK,GAAG,CAAZ,EAAe;IACXV,YAAY,CAACiB,OAAO,CAACP,KAAD,CAAP,CAAeC,IAAhB,CAAZ;IACAV,eAAe,CAAC;MAAEE,IAAI,EAAE;IAAR,CAAD,CAAf;EACH;AACJ,CAPD;;AASA,MAAMe,YAAY,GAAG,CAACF,YAAD,EAAef,eAAf,EAAgCD,YAAhC,KAAiD;EAClE,MAAM;IAAEiB,OAAF;IAAWP;EAAX,IAAqBM,YAA3B;;EAEA,IAAIN,KAAK,GAAGO,OAAO,CAACE,MAAR,GAAiB,CAA7B,EAAgC;IAC5BnB,YAAY,CAACiB,OAAO,CAACP,KAAD,CAAP,CAAeL,EAAhB,CAAZ;IACAJ,eAAe,CAAC;MAAEE,IAAI,EAAE;IAAR,CAAD,CAAf;EACH;AACJ,CAPD;;AASA,MAAMiB,WAAW,GAAG,CAACC,KAAD,EAAQC,MAAR,KAAmB;EACnC,IAAIA,MAAM,CAACnB,IAAP,KAAgB,YAApB,EAAkC;IAC9B,OAAO;MACHM,IAAI,EAAEd,uBAAuB,CAAC0B,KAAK,CAACZ,IAAP,EAAaa,MAAM,CAAClB,OAAP,CAAeM,KAA5B;IAD1B,CAAP;EAGH;;EAED,IAAIY,MAAM,CAACnB,IAAP,KAAgB,iBAApB,EAAuC;IACnC,OAAO;MACHM,IAAI,EAAEZ,sBAAsB,CAACwB,KAAK,CAACZ,IAAP,EAAaa,MAAM,CAAClB,OAAP,CAAeM,KAA5B;IADzB,CAAP;EAGH;;EAED,IAAIY,MAAM,CAACnB,IAAP,KAAgB,QAApB,EAA8B;IAC1B,OAAO;MACHM,IAAI,EAAEb,uBAAuB,CAACyB,KAAK,CAACZ,IAAP;IAD1B,CAAP;EAGH;;EAED,IAAIa,MAAM,CAACnB,IAAP,KAAgB,aAApB,EAAmC;IAC/B,OAAO;MACHM,IAAI,EAAEX,qBAAqB,CAACuB,KAAK,CAACZ,IAAP,EAAaa,MAAM,CAAClB,OAAP,CAAeS,cAA5B;IADxB,CAAP;EAGH;;EAED,OAAOQ,KAAP;AACH,CA1BD;;AA4BA,MAAME,cAAc,GAAG,CAACF,KAAD,EAAQC,MAAR,KAAmB;EACtC,IAAIA,MAAM,CAACnB,IAAP,KAAgB,MAApB,EAA4B;IACxB,MAAM;MAAEc,OAAF;MAAWP;IAAX,IAAqBW,KAA3B;IAEA,MAAMG,UAAU,GAAGP,OAAO,CAACQ,KAAR,CAAc,CAAd,EAAiBf,KAAjB,EAAwBgB,MAAxB,CAA+B,CAACJ,MAAM,CAAClB,OAAR,CAA/B,CAAnB;IAEA,OAAO;MACHa,OAAO,EAAEO,UADN;MAEHd,KAAK,EAAEc,UAAU,CAACL;IAFf,CAAP;EAIH;;EAED,IAAIG,MAAM,CAACnB,IAAP,KAAgB,MAApB,EAA4B;IACxB,OAAO;MACHc,OAAO,EAAEI,KAAK,CAACJ,OADZ;MAEHP,KAAK,EAAEiB,IAAI,CAACC,GAAL,CAASP,KAAK,CAACX,KAAN,GAAc,CAAvB,EAA0B,CAA1B;IAFJ,CAAP;EAIH;;EAED,IAAIY,MAAM,CAACnB,IAAP,KAAgB,MAApB,EAA4B;IACxB,OAAO;MACHc,OAAO,EAAEI,KAAK,CAACJ,OADZ;MAEHP,KAAK,EAAEiB,IAAI,CAACE,GAAL,CAASR,KAAK,CAACX,KAAN,GAAc,CAAvB,EAA0BW,KAAK,CAACJ,OAAN,CAAcE,MAAxC;IAFJ,CAAP;EAIH;;EAED,OAAOE,KAAP;AACH,CA3BD;;AA6BA,MAAMS,YAAY,GAAG,MAAM;EAAA;;EACvB,MAAM,CAACvB,SAAD,EAAYP,YAAZ,IAA4BP,UAAU,CACxC2B,WADwC,EAExC;IAAEX,IAAI,EAAE;EAAR,CAFwC,CAA5C;EAKA,MAAM,CAACO,YAAD,EAAef,eAAf,IAAkCR,UAAU,CAC9C8B,cAD8C,EAE9C;IAAEN,OAAO,EAAE,EAAX;IAAeP,KAAK,EAAE;EAAtB,CAF8C,CAAlD;EAKA,oBACI;IAAA,wBACI;MAAA,qBAAYH,SAAS,CAACE,IAAtB;IAAA;MAAA;MAAA;MAAA;IAAA,QADJ,eAEI;MAAA,2BAAkBsB,IAAI,CAACC,SAAL,CAAehB,YAAf,CAAlB;IAAA;MAAA;MAAA;MAAA;IAAA,QAFJ,eAGI;MAAA,wBACI;QAAQ,OAAO,EAAE,MAAMV,kBAAkB,CAACC,SAAD,CAAzC;QAAA;MAAA;QAAA;QAAA;QAAA;MAAA,QADJ,eAEI;QAAQ,OAAO,EAAE,MAAMK,cAAc,CAACL,SAAD,CAArC;QAAA;MAAA;QAAA;QAAA;QAAA;MAAA,QAFJ;IAAA;MAAA;MAAA;MAAA;IAAA,QAHJ,eAOI;MAAA,wBACI;QAAQ,OAAO,EAAE,MAAMQ,YAAY,CAACC,YAAD,EAAef,eAAf,EAAgCD,YAAhC,CAAnC;QAAA;MAAA;QAAA;QAAA;QAAA;MAAA,QADJ,eAII;QAAQ,OAAO,EAAE,MAAMkB,YAAY,CAACF,YAAD,EAAef,eAAf,EAAgCD,YAAhC,CAAnC;QAAA;MAAA;QAAA;QAAA;QAAA;MAAA,QAJJ;IAAA;MAAA;MAAA;MAAA;IAAA,QAPJ;EAAA;IAAA;IAAA;IAAA;EAAA,QADJ;AAkBH,CA7BD;;GAAM8B,Y;;KAAAA,Y;AA+BN,eAAeA,YAAf"},"metadata":{},"sourceType":"module"}